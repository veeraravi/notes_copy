import org.apache.spark.sql.functions._
import org.apache.spark.sql.types._

def mapToStructArrayGeneric(df: org.apache.spark.sql.DataFrame): org.apache.spark.sql.DataFrame = {
  val transformedCols = df.schema.fields.map { field =>
    field.dataType match {
      case MapType(_, _, _) =>
        map_entries(col(field.name)).alias(field.name)
      case _ =>
        col(field.name)
    }
  }
  df.select(transformedCols: _*)
}
